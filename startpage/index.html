<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Länksamling</title>
  <style>
    :root{
      --bg:#0b0c10; --card:#111318; --text:#e7ebf3; --muted:#a9b0bf; --ring:#6aaaff; --border:#23262f;
      --shadow: 0 1px 1px rgba(0,0,0,.06), 0 6px 18px rgba(0,0,0,.22);
      --radius:18px;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f6f7fb; --card:#ffffff; --text:#0b1020; --muted:#495469; --ring:#2157ea; --border:#e8ecf3;
        --shadow: 0 1px 1px rgba(0,0,0,.03), 0 10px 30px rgba(0,0,0,.08);
      }
    }
    html,body{height:100%}
    body{
      margin:0; font:16px/1.5 system-ui, -apple-system, "Segoe UI", Roboto, Inter, Arial, sans-serif;
      background:var(--bg); color:var(--text); display:flex; flex-direction:column; gap:20px;
    }
    header{ padding:24px clamp(16px,4vw,40px) 0 }
    .title{ font-size:clamp(22px,3vw,34px); font-weight:700; margin:0 0 6px }
    .subtitle{ color:var(--muted); margin:0; font-size:clamp(14px,1.6vw,16px) }
    main{ padding:0 clamp(16px,4vw,40px) 40px }
    .grid{ display:grid; grid-template-columns:repeat(auto-fill, minmax(260px,1fr)); gap:18px }
    .card{
      position:relative; display:flex; gap:12px; align-items:flex-start;
      background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
      padding:16px; box-shadow:var(--shadow); transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease;
      cursor:pointer; text-decoration:none; color:inherit; outline:none;
    }
    .card:hover{ transform:translateY(-2px); box-shadow:0 2px 2px rgba(0,0,0,.06), 0 16px 44px rgba(0,0,0,.28); border-color:color-mix(in oklab, var(--ring) 30%, var(--border)) }
    .card:focus-visible{ box-shadow:0 0 0 3px color-mix(in oklab, var(--ring) 45%, transparent), var(--shadow); border-color:var(--ring) }
    .icon-wrap{
      width:64px; aspect-ratio:1/1; border-radius:14px; background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.06));
      display:grid; place-items:center; overflow:hidden; border:1px solid var(--border); flex:0 0 auto;
    }
    .icon{ width:70%; height:70%; object-fit:contain; image-rendering:-webkit-optimize-contrast }
    .content{ display:flex; flex-direction:column; gap:6px; min-width:0 }
    .name{ font-weight:700; font-size:16px; margin:2px 0 0; overflow:hidden; text-overflow:ellipsis; white-space:nowrap }
    .desc{ color:var(--muted); margin:0; font-size:14px }
    .url{ color:var(--muted); font-size:12px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap }
    .skeleton{ border-radius:var(--radius); border:1px solid var(--border); background:
      linear-gradient(100deg, rgba(255,255,255,0), rgba(255,255,255,.06), rgba(255,255,255,0)) 0 0/200% 100%, var(--card);
      height:120px; animation:shimmer 1.2s infinite; }
    @keyframes shimmer{ to{ background-position:-200% 0 } }
    .empty,.error{ color:var(--muted); border:1px dashed var(--border); border-radius:var(--radius); padding:16px; text-align:center }
    footer{ color:var(--muted); font-size:12px; text-align:center; padding:0 16px 24px }
  </style>
</head>
<body>
  <header>
    <h1 class="title">Länksamling</h1>
    <p class="subtitle">Minimalt JSON-format: <code>[{ name, url, (description?), (image?) }]</code></p>
  </header>

  <main>
    <div id="status" class="skeleton" aria-hidden="true"></div>
    <div id="grid" class="grid" hidden></div>
    <div id="empty" class="empty" hidden>Inga objekt hittades i JSON-filen.</div>
    <div id="error" class="error" hidden>Kunde inte läsa JSON. Kontrollera filvägen och formatet.</div>
  </main>

  <footer>
    Läser från <code>data/resources.json</code>. Ikoner skalas enhetligt och laddas lazy.
  </footer>

  <script>
  // ---- Enkel JSON: [{ "name": "...", "url": "https://..." , "description"?: "...", "image"?: "..." }] ----
  const JSON_URL = 'data/resources.json';

  const el = (tag, props={}, ...children) => {
    const node = document.createElement(tag);
    Object.assign(node, props);
    for(const c of children){ if(c==null) continue; node.appendChild(typeof c === 'string' ? document.createTextNode(c) : c); }
    return node;
  };

  function faviconFor(href){
    try { return `https://www.google.com/s2/favicons?domain=${new URL(href).hostname}&sz=128`; }
    catch { return ''; }
  }

  function toItem(raw){
    const name = (raw?.name ?? '').toString().trim();
    const url  = (raw?.url  ?? '').toString().trim();
    if(!name || !url) return null; // kräver endast name + url
    return {
      name,
      url,
      description: (raw.description ?? '').toString().trim(),
      image: raw.image || null
    };
  }

  function createCard(item){
    const card = el('article', { className:'card', role:'link', tabIndex:0, 'aria-label': item.name });
    const open = () => window.open(item.url, '_blank', 'noopener,noreferrer');
    card.addEventListener('click', open);
    card.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); open(); } });

    const icon = el('div', { className:'icon-wrap' },
      el('img', { className:'icon', loading:'lazy', alt:'', src: item.image || faviconFor(item.url) })
    );

    const name = el('h2', { className:'name', title:item.name }, item.name);
    const descText = item.description || '—';
    const desc = el('p', { className:'desc' }, descText);
    const urlText = el('div', { className:'url' }, new URL(item.url).hostname);

    const content = el('div', { className:'content' }, name, desc, urlText);
    card.append(icon, content);
    return card;
  }

  async function load(){
    const grid = document.getElementById('grid');
    const status = document.getElementById('status');
    const empty = document.getElementById('empty');
    const error = document.getElementById('error');
    try{
      const res = await fetch(JSON_URL, { cache:'no-store' });
      if(!res.ok) throw new Error('HTTP '+res.status);
      const data = await res.json();
      const items = (Array.isArray(data) ? data : []).map(toItem).filter(Boolean);

      status.hidden = true;
      if(!items.length){ empty.hidden = false; return; }

      for(const item of items){ grid.appendChild(createCard(item)); }
      grid.hidden = false;
    }catch(e){
      status.hidden = true; error.hidden = false;
      console.error('Kunde inte läsa JSON:', e);
    }
  }
  load();
  </script>
</body>
</html>
