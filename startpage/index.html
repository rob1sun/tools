<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Länksamling</title>
  <style>
    :root{
      --bg: #0b0c10;
      --card: #111318;
      --text: #e7ebf3;
      --muted: #a9b0bf;
      --ring: #6aaaff;
      --border: #23262f;
      --shadow: 0 1px 1px rgba(0,0,0,.06), 0 6px 18px rgba(0,0,0,.22);
      --radius: 18px;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f6f7fb; --card:#ffffff; --text:#0b1020; --muted:#495469; --ring:#2157ea; --border:#e8ecf3;
        --shadow: 0 1px 1px rgba(0,0,0,.03), 0 10px 30px rgba(0,0,0,.08);
      }
    }
    html,body{height:100%}
    body{
      margin:0; font: 16px/1.5 system-ui, -apple-system, "Segoe UI", Roboto, Inter, Arial, sans-serif;
      background: var(--bg); color: var(--text);
      display:flex; flex-direction:column; gap:20px;
    }
    header{
      padding: 24px clamp(16px, 4vw, 40px) 0;
    }
    .title{ font-size: clamp(22px, 3vw, 34px); font-weight: 700; letter-spacing:.2px; margin:0 0 6px}
    .subtitle{ color: var(--muted); margin:0; font-size: clamp(14px, 1.6vw, 16px)}
    main{ padding: 0 clamp(16px, 4vw, 40px) 40px }
    .grid{
      display:grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 18px;
    }
    .card{
      position:relative; display:flex; flex-direction:column; gap:12px;
      background: var(--card); border:1px solid var(--border); border-radius: var(--radius);
      padding: 16px; box-shadow: var(--shadow); transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
      cursor:pointer; text-decoration:none; color:inherit; outline: none;
    }
    .card:hover{ transform: translateY(-2px); box-shadow: 0 2px 2px rgba(0,0,0,.06), 0 16px 44px rgba(0,0,0,.28); border-color: color-mix(in oklab, var(--ring) 30%, var(--border)); }
    .card:focus-visible{ box-shadow: 0 0 0 3px color-mix(in oklab, var(--ring) 45%, transparent), var(--shadow); border-color: var(--ring); }
    .icon-wrap{
      width: 64px; aspect-ratio: 1 / 1; border-radius: 14px; background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.06));
      display:grid; place-items:center; overflow:hidden; border:1px solid var(--border)
    }
    .icon{
      width: 70%; height: 70%; object-fit: contain; image-rendering: -webkit-optimize-contrast;
    }
    .name{ font-weight: 700; font-size: 16px; margin: 2px 0 0 }
    .desc{ color: var(--muted); margin:0; font-size: 14px }
    .links{ display:flex; flex-wrap:wrap; gap:8px; margin-top:auto }
    .link-pill{
      font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); color: var(--text);
      background: color-mix(in oklab, var(--card) 85%, #000 15%); text-decoration:none; outline:none;
    }
    .link-pill:hover{ border-color: color-mix(in oklab, var(--ring) 35%, var(--border)) }
    .link-pill:focus-visible{ box-shadow: 0 0 0 3px color-mix(in oklab, var(--ring) 45%, transparent) }
    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0 }
    /* Skeleton loader */
    .skeleton{
      border-radius: var(--radius); border:1px solid var(--border); background:
        linear-gradient(100deg, rgba(255,255,255,0), rgba(255,255,255,.06), rgba(255,255,255,0)) 0 0/ 200% 100%,
        var(--card);
      height: 120px; animation: shimmer 1.2s infinite;
    }
    @keyframes shimmer{ to { background-position: -200% 0 } }
    .empty, .error{ color: var(--muted); border:1px dashed var(--border); border-radius: var(--radius); padding: 16px; text-align:center }
    footer{ color:var(--muted); font-size:12px; text-align:center; padding:0 16px 24px }
  </style>
</head>
<body>
  <header>
    <h1 class="title">Länksamling</h1>
    <p class="subtitle">Klicka på ett kort för att öppna primär länk. Ytterligare länkar finns som knappar.</p>
  </header>

  <main>
    <div id="status" class="skeleton" aria-hidden="true"></div>
    <div id="grid" class="grid" hidden></div>
    <div id="empty" class="empty" hidden>Inga objekt hittades i JSON-filen.</div>
    <div id="error" class="error" hidden>Kunde inte läsa JSON. Kontrollera filvägen och formatet.</div>
  </main>

  <footer>
    Läser från <code>data/resources.json</code>. Bilder laddas lazy och skalas enhetligt.
  </footer>

  <script>
  // --- Konfiguration: sökväg till JSON i underkatalog ---
  const JSON_URL = 'data/resources.json';

  // Hjälpfunktioner
  const el = (tag, props={}, ...children) => {
    const node = document.createElement(tag);
    Object.assign(node, props);
    for(const c of children){
      if(c == null) continue;
      node.appendChild(typeof c === 'string' ? document.createTextNode(c) : c);
    }
    return node;
  };

  const normaliseItem = (raw, idx) => {
    // Stöder både {url:""} och {links:[...]} – konverterar till standard
    let links = [];
    if (Array.isArray(raw.links)) {
      links = raw.links
        .map(l => typeof l === 'string' ? { href:l, label:new URL(l).hostname } : l)
        .filter(l => l && l.href);
    } else if (raw.url) {
      links = [{ href: raw.url, label: new URL(raw.url).hostname }];
    }
    const primary = raw.primary || (links[0]?.href ?? null);

    return {
      id: raw.id ?? `item-${idx}`,
      name: String(raw.name ?? '').trim(),
      description: String(raw.description ?? '').trim(),
      image: raw.image ?? null,
      links,
      primary
    };
  };

  const createCard = (item) => {
    const card = el('article', { className:'card', role:'link', tabIndex:0, 'aria-label': item.name });
    card.dataset.href = item.primary || '';
    // Klick/Enter/Space öppnar primär-länk
    const openPrimary = () => {
      if(!card.dataset.href) return;
      window.open(card.dataset.href, '_blank', 'noopener,noreferrer');
    };
    card.addEventListener('click', (e) => {
      // Undvik att klick på piller-länkar bubblar
      if (e.target.closest('.link-pill')) return;
      openPrimary();
    });
    card.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); openPrimary(); }
    });

    const icon = el('div', { className:'icon-wrap' },
      el('img', { className:'icon', loading:'lazy', alt:'', src: item.image || makeFavicon(item.primary || item.links[0]?.href) })
    );

    const name = el('h2', { className:'name' }, item.name || 'Namnlöst objekt');
    const desc = el('p', { className:'desc' }, item.description || '—');

    const linksWrap = el('div', { className:'links' });
    for (const [i, l] of item.links.entries()) {
      const a = el('a', {
        className:'link-pill', href: l.href, target:'_blank', rel:'noopener noreferrer',
        title: l.href
      }, l.label || (new URL(l.href).hostname) || `Länk ${i+1}`);
      // Hindra kortklick
      a.addEventListener('click', (e)=> e.stopPropagation());
      linksWrap.appendChild(a);
    }

    card.append(icon, name, desc, linksWrap);
    return card;
  };

  // Försök hämta favicon om ingen bild angivits
  function makeFavicon(href){
    try{
      const u = new URL(href);
      // Använd webbläsarens inbyggda favicon-proxy (Google S2 – funkar utan nyckel)
      return `https://www.google.com/s2/favicons?domain=${u.hostname}&sz=128`;
    }catch{ return ''; }
  }

  async function load(){
    const grid = document.getElementById('grid');
    const status = document.getElementById('status');
    const empty = document.getElementById('empty');
    const error = document.getElementById('error');
    try{
      const res = await fetch(JSON_URL, { cache:'no-store' });
      if (!res.ok) throw new Error('HTTP ' + res.status);
      const data = await res.json();
      const items = Array.isArray(data) ? data : Array.isArray(data.items) ? data.items : [];
      const normalized = items.map(normaliseItem).filter(x => x.links.length);

      status.hidden = true;
      if (!normalized.length){ empty.hidden = false; return; }

      for (const item of normalized){
        grid.appendChild(createCard(item));
      }
      grid.hidden = false;
    }catch(e){
      status.hidden = true; error.hidden = false;
      console.error('Kunde inte läsa JSON:', e);
    }
  }
  load();
  </script>
</body>
</html>
